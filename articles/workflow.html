<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to eva3dm • eva3dm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to eva3dm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">eva3dm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.20</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/workflow.html">Introduction to eva3dm</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Schuch666/eva3dm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to eva3dm</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Schuch666/eva3dm/blob/main/vignettes/workflow.Rmd" class="external-link"><code>vignettes/workflow.Rmd</code></a></small>
      <div class="d-none name"><code>workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://schuch666.github.io/eva3dm/">eva3dm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/riem/" class="external-link">riem</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.60</span></span></code></pre></div>
<p>The recommended workflow to evaluate your model results will include
4 steps:</p>
<ol style="list-style-type: decimal">
<li><p>Pre-processing of observations</p></li>
<li><p>Pre-processing of model output</p></li>
<li><p>Model Evaluation</p></li>
<li><p>Visualization</p></li>
</ol>
<p>The exact steps needed for evaluation will be different for different
models, different observation data-sets, and different variables.
However, in this vignette is presented an example of evaluation of
temperature at surface level (T2) from WRF-Chem for a simulation at 3-km
of resolution for January 2016 using data from METeorological Aerodrome
Report (METAR).</p>
<p>1 - Pre-processing of observations: We are using the r-package
<code>riem</code> to download METAR data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_date</span>  <span class="op">&lt;-</span> <span class="st">"2016-01-01"</span></span>
<span><span class="va">end_date</span>    <span class="op">&lt;-</span> <span class="st">"2016-02-01"</span></span>
<span><span class="va">sites</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SBGR"</span>,<span class="st">"SBKP"</span>,<span class="st">"SBMT"</span>,<span class="st">"SBSJ"</span>,<span class="st">"SBSP"</span>,<span class="st">"SBST"</span>,<span class="st">"SBTA"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">METAR</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.POSIXt.html" class="external-link">seq.POSIXt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, </span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, </span>
<span>                                       by <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">site</span> <span class="kw">in</span> <span class="va">sites</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Trying to download METAR from:'</span>,<span class="va">site</span>,<span class="st">'...\n'</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">DATA</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu">riem</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/riem/reference/riem_measures.html" class="external-link">riem_measures</a></span><span class="op">(</span>station    <span class="op">=</span> <span class="va">site</span>,</span>
<span>                                       date_start <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>                                       date_end   <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>                                       elev       <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                       latlon     <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                   error <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'fail to download, loading some data ...\n'</span><span class="op">)</span></span>
<span>    <span class="va">METAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,package<span class="op">=</span><span class="st">"eva3dm"</span><span class="op">)</span>,</span>
<span>                            <span class="st">"/METAR_MASP_jan_2016.Rds"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">break</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">DATA</span><span class="op">$</span><span class="va">valid</span>,</span>
<span>                     T2   <span class="op">=</span> <span class="va">DATA</span><span class="op">$</span><span class="va">tmpf</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'date'</span>, <span class="va">site</span><span class="op">)</span></span>
<span>  <span class="va">METAR</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span>x     <span class="op">=</span> <span class="va">METAR</span>, </span>
<span>                       y     <span class="op">=</span> <span class="va">DATA</span>, </span>
<span>                       by    <span class="op">=</span> <span class="st">"date"</span>, </span>
<span>                       all   <span class="op">=</span> <span class="cn">T</span>, </span>
<span>                       sort  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Trying to download METAR from: SBGR ...</span></span>
<span><span class="co">#&gt; Trying to download METAR from: SBKP ...</span></span>
<span><span class="co">#&gt; Trying to download METAR from: SBMT ...</span></span>
<span><span class="co">#&gt; Trying to download METAR from: SBSJ ...</span></span>
<span><span class="co">#&gt; Trying to download METAR from: SBSP ...</span></span>
<span><span class="co">#&gt; Trying to download METAR from: SBST ...</span></span>
<span><span class="co">#&gt; Trying to download METAR from: SBTA ...</span></span></code></pre></div>
<p>Lets check if the observations are ok</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">METAR</span><span class="op">$</span><span class="va">date</span>, <span class="va">METAR</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, ty <span class="op">=</span> <span class="st">'l'</span>,xlab <span class="op">=</span> <span class="st">''</span>,ylab <span class="op">=</span> <span class="st">'T2'</span>, main <span class="op">=</span> <span class="st">'METAR OBS'</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/check-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">METAR</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  date SBGR SBKP SBMT SBSJ SBSP SBST SBTA</span></span>
<span><span class="co">#&gt; 1 2016-01-01 00:00:00 75.2 71.6 75.2 77.0 77.0   NA   NA</span></span>
<span><span class="co">#&gt; 2 2016-01-01 01:00:00 75.2   NA 75.2 77.0 75.2   NA   NA</span></span>
<span><span class="co">#&gt; 3 2016-01-01 01:01:00   NA   NA   NA   NA 75.2   NA   NA</span></span>
<span><span class="co">#&gt; 4 2016-01-01 02:00:00 73.4 71.6   NA 77.0 73.4   NA   NA</span></span>
<span><span class="co">#&gt; 5 2016-01-01 03:00:00 73.4 71.6   NA 75.2 71.6   NA   NA</span></span>
<span><span class="co">#&gt; 6 2016-01-01 04:00:00 71.6 69.8   NA 75.2   NA   NA   NA</span></span></code></pre></div>
<p>In this case the temperature units needs to be converted from
Fahrenheit to Celsius and the data needs to be grouped or averaged in
time, in this case we are using the <code><a href="../reference/hourly.html">hourly()</a></code> to perform a
evaluation against hourly data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">METAR</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span><span class="op">/</span><span class="fl">9</span> <span class="op">*</span> <span class="op">(</span><span class="va">METAR</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">32</span><span class="op">)</span></span>
<span><span class="va">METAR</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hourly.html">hourly</a></span><span class="op">(</span><span class="va">METAR</span><span class="op">)</span></span>
<span><span class="co">#&gt; processing hourly data ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">METAR</span><span class="op">$</span><span class="va">date</span>, <span class="va">METAR</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, ty <span class="op">=</span> <span class="st">'l'</span>,xlab <span class="op">=</span> <span class="st">''</span>,ylab <span class="op">=</span> <span class="st">'T2'</span>, main <span class="op">=</span> <span class="st">'METAR processed OBS'</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/observation-1.png" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">METAR</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  date SBGR SBKP SBMT SBSJ     SBSP SBST SBTA</span></span>
<span><span class="co">#&gt; 1 2016-01-01 00:00:00   24   22   24   25 25.00000   NA   NA</span></span>
<span><span class="co">#&gt; 2 2016-01-01 01:00:00   24   NA   24   25 24.00000   NA   NA</span></span>
<span><span class="co">#&gt; 3 2016-01-01 02:00:00   23   22   NA   25 23.00000   NA   NA</span></span>
<span><span class="co">#&gt; 4 2016-01-01 03:00:00   23   22   NA   24 22.00000   NA   NA</span></span>
<span><span class="co">#&gt; 5 2016-01-01 04:00:00   22   21   NA   24 22.00000   NA   NA</span></span>
<span><span class="co">#&gt; 6 2016-01-01 05:00:00   22   21   NA   23 21.33333   NA   NA</span></span></code></pre></div>
<p>For the next step a site-list with latitude and longitude of each
surface station is needed, a list of all METAR stations is available in
eva3dm package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,package<span class="op">=</span><span class="st">"eva3dm"</span><span class="op">)</span>,<span class="st">"/sites_METAR.Rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">site_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      station_name      lat      lon elev      begin  end</span></span>
<span><span class="co">#&gt; EHAK A12-CPP HELIPAD OIL PLATFORM 55.39917  3.81028   50 2009-02-09 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; EKYT                      Aalborg 57.09639  9.85056    3 1940-04-01 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; EKAH                       Aarhus 56.30833 10.62556   25 1972-12-31 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; OIAA                       Abadan 30.36667 48.25000   11 1943-11-30 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; OISA                       ABADEH 31.18333 52.66667 2004 1977-12-01 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; UNAA                       Abakan 53.74000 91.38500  245 1999-01-14 &lt;NA&gt;</span></span></code></pre></div>
<p>2 - Pre-processing of model output: The model output are large files
and does not allow the direct comparison with observations. The package
provides a function that extracts time-series from geographic locations
from a site-list. The function <code><a href="../reference/extract_serie.html">extract_serie()</a></code> extracts the
time-series from a list of files and saves the output in R file (in this
example we are reading the R file generated by
<code><a href="../reference/extract_serie.html">extract_serie()</a></code>). An finally, the temperature extracted
from the model is converted from Kelvin to Celsius.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## to extract time-series from WRF-Chem model</span></span>
<span><span class="co">## wrf_files &lt;- dir(pattern = "wrfout_d03")</span></span>
<span><span class="co">## extract_serie(filelist = wrf_files, point = site_list, variable="T2", prefix="model.d03", field="3d")</span></span>
<span><span class="va">model_d03</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,package<span class="op">=</span><span class="st">"eva3dm"</span><span class="op">)</span>,<span class="st">"/model.d03.T2.Rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model_d03</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">model_d03</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">273.15</span></span></code></pre></div>
<p>NOTE: to extract time-series from other models (not WRF or WRF-Chem),
the arguments <code>latitude</code> and <code>longitude</code> from the
function <code><a href="../reference/extract_serie.html">extract_serie()</a></code> need to match the name of these
variables for latitude and longitude in the model output. If the model
do not include the Times variable, <code>use_TFLAG</code> must be set to
<code>TRUE</code> to extract and convert the time from TFLAG variable
(for example for CMAQ / CAMx models) or <code>use_datesec</code> must be
set to <code>TRUE</code> to extract and convert time from the datasec
variable (for example for WACCM / CAM-Chem models).</p>
<p>3 - Model Evaluation: The functions <code><a href="../reference/eva.html">eva()</a></code> can be used to
calculate the statistical indexes from time-series for individual
stations or all stations combined.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">site</span> <span class="kw">in</span> <span class="va">sites</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eva.html">eva</a></span><span class="op">(</span>mo <span class="op">=</span> <span class="va">model_d03</span>, ob <span class="op">=</span> <span class="va">METAR</span>, site <span class="op">=</span> <span class="va">site</span>, table <span class="op">=</span> <span class="va">table</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; SBGR has 734 valid observations</span></span>
<span><span class="co">#&gt; SBKP has 735 valid observations</span></span>
<span><span class="co">#&gt; SBMT has 513 valid observations</span></span>
<span><span class="co">#&gt; SBSJ has 740 valid observations</span></span>
<span><span class="co">#&gt; SBSP has 737 valid observations</span></span>
<span><span class="co">#&gt; SBST has 432 valid observations</span></span>
<span><span class="co">#&gt; SBTA has 407 valid observations</span></span>
<span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eva.html">eva</a></span><span class="op">(</span>mo <span class="op">=</span> <span class="va">model_d03</span>, ob <span class="op">=</span> <span class="va">METAR</span>, site <span class="op">=</span> <span class="st">'ALL'</span>, table <span class="op">=</span> <span class="va">table</span><span class="op">)</span></span>
<span><span class="co">#&gt; combining all sites...</span></span>
<span><span class="co">#&gt; SBGR(ok) SBKP(ok) SBMT(ok) SBSJ(ok) SBSP(ok) SBST(ok) SBTA(ok) ...</span></span>
<span><span class="co">#&gt;  total: 7 stations with valid data, 0 stations not included</span></span>
<span><span class="co">#&gt; ALL has 4298 valid observations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">table</span><span class="op">)</span></span>
<span><span class="co">#&gt;         n      Obs      Sim         r       IOA FA2     RMSE          MB</span></span>
<span><span class="co">#&gt; SBGR  734 22.63965 22.74450 0.7775355 0.8770425   1 2.496525  0.10485920</span></span>
<span><span class="co">#&gt; SBKP  735 23.91111 23.85882 0.7727177 0.8686615   1 2.736654 -0.05228941</span></span>
<span><span class="co">#&gt; SBMT  513 23.87232 23.84531 0.7422773 0.8552605   1 2.702797 -0.02701357</span></span>
<span><span class="co">#&gt; SBSJ  740 23.76284 23.05983 0.7844412 0.8702301   1 2.667141 -0.70301015</span></span>
<span><span class="co">#&gt; SBSP  737 22.50583 22.48103 0.7682679 0.8676724   1 2.506979 -0.02480130</span></span>
<span><span class="co">#&gt; SBST  432 25.99113 26.09150 0.7568891 0.8657718   1 2.110475  0.10037735</span></span>
<span><span class="co">#&gt; SBTA  407 25.49631 25.77835 0.7167453 0.8430608   1 2.912318  0.28203548</span></span>
<span><span class="co">#&gt; ALL  4298 23.78202 23.69927 0.7817265 0.8784392   1 2.601999 -0.08275445</span></span>
<span><span class="co">#&gt;            ME    NMB (%)  NME (%)</span></span>
<span><span class="co">#&gt; SBGR 1.888910  0.4631662 8.343374</span></span>
<span><span class="co">#&gt; SBKP 2.116666 -0.2186825 8.852229</span></span>
<span><span class="co">#&gt; SBMT 2.086712 -0.1131585 8.741136</span></span>
<span><span class="co">#&gt; SBSJ 2.104004 -2.9584436 8.854178</span></span>
<span><span class="co">#&gt; SBSP 1.905254 -0.1101994 8.465600</span></span>
<span><span class="co">#&gt; SBST 1.682075  0.3861985 6.471727</span></span>
<span><span class="co">#&gt; SBTA 2.318141  1.1061814 9.092063</span></span>
<span><span class="co">#&gt; ALL  2.011160 -0.3479706 8.456642</span></span></code></pre></div>
<p>4 - Visualization: The function <code><a href="../reference/overlay.html">overlay()</a></code> can be used to
plot the results from <code><a href="../reference/eva.html">eva()</a></code> on a map. However, first the
data need to be georeferenced using <code>%at%</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial_table</span> <span class="op">&lt;-</span> <span class="va">table</span> <span class="op"><a href="../reference/grapes-at-grapes.html">%at%</a></span> <span class="va">site_list</span></span>
<span><span class="co">#&gt; georeferencing table at site_list</span></span>
<span><span class="fu"><a href="../reference/overlay.html">overlay</a></span><span class="op">(</span><span class="va">spatial_table</span>, z <span class="op">=</span> <span class="st">'MB'</span>, main <span class="op">=</span> <span class="st">'T2 main bias (MB)'</span>,expand <span class="op">=</span> <span class="fl">1.6</span>,lim <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">masp</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,package<span class="op">=</span><span class="st">"eva3dm"</span><span class="op">)</span>,<span class="st">"/masp.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">BR</span>   <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,package<span class="op">=</span><span class="st">"eva3dm"</span><span class="op">)</span>,<span class="st">"/BR.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">BR</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">masp</span>, col <span class="op">=</span> <span class="st">'gray'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/legend_range.html">legend_range</a></span><span class="op">(</span><span class="va">spatial_table</span><span class="op">$</span><span class="va">MB</span>,y <span class="op">=</span> <span class="va">table</span><span class="op">[</span><span class="st">"ALL"</span>,<span class="st">"MB"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow_files/figure-html/visualize-1.png" width="672">
The WRF-Chem temperature in this example showed a very low MB, except
for the SBSJ station (MB=-0.7), which is in the criteria for acceptable
performance (|MB| &lt; 0.5) and the criteria for evaluation for complex
terrain for the SBSJ case (|MB| &lt; 1.0). Another criteria for
temperature are IAO &gt; 0.8 and ME &lt; 2.0 (ME &lt; 3, for complex
terrain), in general the model presented a reasonable performance for
temperature. More information and references can be found on the
documentation of <code><a href="../reference/stat.html">stat()</a></code> function.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Schuch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
